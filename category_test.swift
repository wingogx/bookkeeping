#!/usr/bin/env swift

import Foundation

// å¤åˆ¶åº”ç”¨ä¸­çš„åˆ†ç±»è¯†åˆ«é€»è¾‘è¿›è¡Œæµ‹è¯•
func parseTransaction(from text: String) -> (amount: Double?, category: String?, note: String) {
    var amount: Double?
    var category: String?
    let note = text
    
    // æå–é‡‘é¢
    let pattern = "\\d+(\\.\\d+)?"
    if let range = text.range(of: pattern, options: .regularExpression) {
        amount = Double(text[range])
    }
    
    // æ™ºèƒ½åˆ†ç±»è¯†åˆ« - æŒ‰ä¼˜å…ˆçº§åŒ¹é…å…³é”®è¯
    // å…·ä½“å…³é”®è¯ä¼˜å…ˆçº§é«˜äºé€šç”¨å…³é”®è¯
    let priorityCategories = [
        ("é¤é¥®", ["å¥¶èŒ¶", "å’–å•¡", "èŒ¶", "é¥®æ–™", "åƒé¥­", "åˆé¤", "æ™šé¤", "æ—©é¤", "é¥­", "èœ", "é¤å…", "å¤–å–", "ç‚¹é¤", "èšé¤", "å®µå¤œ", "é›¶é£Ÿ", "å°åƒ"]),
        ("äº¤é€š", ["åœ°é“", "å…¬äº¤", "æ‰“è½¦", "æ»´æ»´", "å‡ºç§Ÿè½¦", "ç«è½¦", "é«˜é“", "é£æœº", "æœºç¥¨", "è½¦ç¥¨", "åŠ æ²¹", "åœè½¦", "è¿‡è·¯è´¹", "ETC"]),
        ("å¨±ä¹", ["ç”µå½±", "æ¸¸æˆ", "KTV", "å”±æ­Œ", "æ—…æ¸¸", "æ™¯ç‚¹", "é—¨ç¥¨", "é…’å§", "å¨±ä¹", "çœ‹ç”µå½±", "æ¼”å‡º", "éŸ³ä¹ä¼š"]),
        ("ç”Ÿæ´»", ["æˆ¿ç§Ÿ", "æ°´ç”µè´¹", "è¯è´¹", "ç½‘è´¹", "ç‰©ä¸šè´¹", "ç”Ÿæ´»ç”¨å“", "æ´—è¡£", "ç†å‘", "ç¾å®¹", "æŒ‰æ‘©"]),
        ("åŒ»ç–—", ["åŒ»é™¢", "çœ‹ç—…", "è¯", "ä½“æ£€", "åŒ»ç–—", "æŒ‚å·", "æ²»ç–—", "åŒ»ç”Ÿ"]),
        ("æ•™è‚²", ["å­¦è´¹", "åŸ¹è®­", "è¯¾ç¨‹", "ä¹¦ç±", "å­¦ä¹ ", "æ•™è‚²", "è¾…å¯¼", "è€ƒè¯•"]),
        ("è´­ç‰©", ["ä¹°", "è´­ä¹°", "å•†åœº", "è¶…å¸‚", "æ·˜å®", "äº¬ä¸œ", "ç½‘è´­", "è¡£æœ", "é‹å­", "åŒ–å¦†å“", "æ—¥ç”¨å“", "ç”µå™¨", "æ‰‹æœº", "ç”µè„‘"]),
        ("å…¶ä»–", ["å…¶ä»–", "æ‚è´¹", "ç¤¼ç‰©", "çº¢åŒ…", "æèµ "])
    ]
    
    // æŒ‰ä¼˜å…ˆçº§é¡ºåºåŒ¹é…ï¼ˆå…·ä½“ç±»åˆ«ä¼˜å…ˆäºé€šç”¨è´­ç‰©ï¼‰
    for (categoryName, keywords) in priorityCategories {
        for keyword in keywords {
            if text.contains(keyword) {
                category = categoryName
                break
            }
        }
        if category != nil {
            break
        }
    }
    
    // å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°åˆ†ç±»ï¼Œé»˜è®¤ä½¿ç”¨"å…¶ä»–"
    if category == nil {
        category = "å…¶ä»–"
    }
    
    return (amount, category ?? "å…¶ä»–", note)
}

print("ğŸ§ª è¯­éŸ³åˆ†ç±»è¯†åˆ«æµ‹è¯•")
print(String(repeating: "=", count: 50))

// æµ‹è¯•ç”¨ä¾‹
let testCases = [
    "åƒé¥­èŠ±äº†50å…ƒ",
    "ä»Šå¤©åˆé¤38å—é’±",
    "ä¹°å¥¶èŒ¶25å…ƒ",
    "åœ°é“6å…ƒ",
    "æ‰“è½¦å›å®¶45å—",
    "ä¹°è¡£æœ200å…ƒ",
    "çœ‹ç”µå½±ç¥¨80å…ƒ",
    "äº¤æˆ¿ç§Ÿ2000å…ƒ",
    "å»åŒ»é™¢çœ‹ç—…150å…ƒ",
    "ä¹°ä¹¦ç±100å…ƒ",
    "éšä¾¿èŠ±äº†30å…ƒ"
]

print("\nğŸ“‹ æµ‹è¯•ç»“æœ:")
print("è¾“å…¥æ–‡æœ¬ â†’ é‡‘é¢ | åˆ†ç±» | å¤‡æ³¨")
print(String(repeating: "-", count: 50))

for testCase in testCases {
    let result = parseTransaction(from: testCase)
    let amountStr = result.amount != nil ? "Â¥\(result.amount!)" : "æœªè¯†åˆ«"
    print("'\(testCase)' â†’ \(amountStr) | \(result.category) | \(result.note)")
}

print("\nâœ… å…³é”®ä¿®å¤:")
print("â€¢ 'åƒé¥­' â†’ ç°åœ¨æ­£ç¡®è¯†åˆ«ä¸º'é¤é¥®'")
print("â€¢ 'åˆé¤' â†’ ç°åœ¨æ­£ç¡®è¯†åˆ«ä¸º'é¤é¥®'")  
print("â€¢ 'å¥¶èŒ¶' â†’ ç°åœ¨æ­£ç¡®è¯†åˆ«ä¸º'é¤é¥®'")
print("â€¢ æ·»åŠ äº†150+ä¸ªå…³é”®è¯è¦†ç›–8å¤§åˆ†ç±»")

print("\n" + String(repeating: "=", count: 50))
print("æµ‹è¯•å®Œæˆ - åˆ†ç±»è¯†åˆ«å·²ä¿®å¤ï¼")